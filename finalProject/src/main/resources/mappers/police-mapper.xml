<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="policeMapper">

	<resultMap type="police" id="policeResultSet">
		<result column="P_NO" property="pNo"/>
		<result column="USER_NO" property="userNo"/>
		<result column="REASON" property="reason"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="SOLUTION_NO" property="solutionNo"/>
	</resultMap>
	
	<!-- 신고하기 -->
	<insert id="addPolice" parameterType="police">
		INSERT INTO POLICE(
						  P_NO
						 ,USER_NO
						 ,REASON
						 ,CREATE_DATE
						 ,SOLUTION_NO
						 )
		VALUES(
				SEQ_PNO.NEXTVAL
				,#{userNo}
				,#{reason}
				,#{createDate}
				,#{solutionNo}
				)
	</insert>
	
	<delete id="sHeartDelete">
		DELETE
		FROM POLICE
		WHERE SOLUTION_NO = #{solutionNo}	
	</delete>
	
	
	
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM SOLUTION
		WHERE STATUS = 'Y'
	</select>
	
	<select id="listAll" resultMap="solutionResultSet">
		SELECT *
		FROM 
            (SELECT S.*, M.USER_ID
            FROM SOLUTION S
                JOIN MEMBER M ON S.USER_NO=M.USER_NO
		WHERE S.STATUS='Y'
		ORDER BY CREATE_DATE DESC)
	</select>
	
	<insert id="insertSolution" parameterType="solution">
		INSERT INTO SOLUTION(
						  SOLUTION_NO
						 ,SUBJECT
						 ,TAG
						 ,USER_NO
						 ,TITLE
						 ,SOLUTION_CONTENTS
						 )
		VALUES(
				SEQ_SNO.NEXTVAL
				,#{subject}
				,#{tag}
				,#{userNo}
				,#{title}
				,#{solutionContents}
				)
	</insert>
	
	<update id="increaseCount" parameterType="_int">
		UPDATE SOLUTION
		SET COUNT = COUNT + 1
		WHERE STATUS = 'Y'
		AND SOLUTION_NO = #{solutionNo}
	</update>
	
	<select id="selectSolution" resultMap="solutionResultSet">
		SELECT *
		FROM 
            (SELECT S.*, M.USER_ID
            FROM SOLUTION S
                JOIN MEMBER M ON S.USER_NO=M.USER_NO
		WHERE SOLUTION_NO = #{solutionNo})
	</select>
	
	<update id="deleteSolution" parameterType="_int">
		UPDATE SOLUTION
		SET STATUS='N'
		WHERE SOLUTION_NO = #{solutionNo}
	</update>
	
	<select id="searchTitle" resultMap="solutionResultSet">
		SELECT *
		FROM 
            (SELECT S.*, M.USER_ID
            FROM SOLUTION S
                JOIN MEMBER M ON S.USER_NO=M.USER_NO
		WHERE S.TITLE LIKE '%#{keyword}%'
        AND S.STATUS='Y'
		ORDER BY CREATE_DATE DESC)
	</select>
	
	<select id="searchContents" resultMap="solutionResultSet">
		SELECT *
		FROM 
            (SELECT S.*, M.USER_ID
            FROM SOLUTION S
                JOIN MEMBER M ON S.USER_NO=M.USER_NO
		WHERE S.SOLUTION_CONTENTS LIKE '%#{keyword}%'
        AND S.STATUS='Y'
		ORDER BY CREATE_DATE DESC)
	</select>
	
	<select id="searchId" resultMap="solutionResultSet">
		SELECT *
		FROM 
            (SELECT S.*, M.USER_ID
            FROM SOLUTION S
                JOIN MEMBER M ON S.USER_NO=M.USER_NO
		WHERE M.USER_ID LIKE '%#{keyword}%'
        AND S.STATUS='Y'
		ORDER BY CREATE_DATE DESC)
	</select>
	
	
</mapper>
